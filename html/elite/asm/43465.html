<!DOCTYPE html>
<html>
<head>
<title>Elite: Routine at A9C9</title>
<meta charset="utf-8" />
<link rel="stylesheet" type="text/css" href="../skoolkit.css" />
</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a href="../index.html">Elite</a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="43464.html">A9C8</a>
</td>
<td class="up">Up: <a href="../maps/all.html#43465">Map</a></td>
<td class="next">
Next: <a href="43536.html">AA10</a>
</td>
</tr>
</table>
<div class="description">A9C9: Routine at A9C9</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="5">
<div class="details">
<div class="paragraph">
Used by the routine at <a href="43085.html">draw_ship_and_laser</a>.
</div>
</div>
<table class="input">
<tr class="asm-input-header">
<th colspan="2">Input</th>
</tr>
<tr>
<td class="register">IX</td>
<td class="register-desc">Address of ship structure</td>
</tr>
<tr>
<td class="register">IY</td>
<td class="register-desc">Address of blueprint</td>
</tr>
</table>
</td>
</tr>
<tr>
<td class="asm-label">vertex_visibility</td>
<td class="address-2"><span id="43465"></span>A9C9</td>
<td class="instruction">PUSH IY</td>
<td class="comment-1" rowspan="1">Push blueprint</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43467"></span>A9CB</td>
<td class="instruction">PUSH IY</td>
<td class="comment-1" rowspan="1">Push blueprint</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43469"></span>A9CD</td>
<td class="instruction">LD A,(IY+$03)</td>
<td class="comment-1" rowspan="1">Number of vertices</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43472"></span>A9D0</td>
<td class="instruction">EX (SP),IX</td>
<td class="comment-1" rowspan="1">IX = blueprint, stack = ship</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43474"></span>A9D2</td>
<td class="instruction">LD D,(IY+$0D)</td>
<td class="comment-1" rowspan="2">Offset to vertices</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43477"></span>A9D5</td>
<td class="instruction">LD E,(IY+$0C)</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43480"></span>A9D8</td>
<td class="instruction">ADD IX,DE</td>
<td class="comment-1" rowspan="1">Add offset to blueprint base</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43482"></span>A9DA</td>
<td class="instruction">LD IY,<a href="43412.html">ship_calculations</a></td>
<td class="comment-1" rowspan="1">Table of ship calculations</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="43486"></span>
<div class="comments">
<div class="paragraph">
This entry point is used by the routine at <a href="44194.html">project_vertex</a>.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label">vertex_visibility_0</td>
<td class="address-2"><span id="43486"></span>A9DE</td>
<td class="instruction">PUSH AF</td>
<td class="comment-1" rowspan="1">Push counter</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43487"></span>A9DF</td>
<td class="instruction">LD A,(<a href="43450.html">byte_at_A9BA</a>)</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43490"></span>A9E2</td>
<td class="instruction">ADD A,$03</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43492"></span>A9E4</td>
<td class="instruction">LD (<a href="43450.html">byte_at_A9BA</a>),A</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43495"></span>A9E7</td>
<td class="instruction">LD A,(IX+$03)</td>
<td class="comment-1" rowspan="1">Vertex visibility and signs</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43498"></span>A9EA</td>
<td class="instruction">AND $1F</td>
<td class="comment-1" rowspan="1">Isolate visibility</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43500"></span>A9EC</td>
<td class="instruction">CP $1F</td>
<td class="comment-1" rowspan="1">Is it max?</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43502"></span>A9EE</td>
<td class="instruction">JR Z,<a href="43465.html#43511">vertex_visibility_1</a></td>
<td class="comment-1" rowspan="1">If yes skip next</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43504"></span>A9F0</td>
<td class="instruction">LD B,A</td>
<td class="comment-1" rowspan="1">B = visibility</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43505"></span>A9F1</td>
<td class="instruction">LD A,(<a href="43448.html">ship_distance</a>)</td>
<td class="comment-1" rowspan="1">A = ship distance</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43508"></span>A9F4</td>
<td class="instruction">CP B</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43509"></span>A9F5</td>
<td class="instruction">JR NC,<a href="43465.html#43528">vertex_visibility_3</a></td>
<td class="comment-1" rowspan="1">Skip edge if too far</td>
</tr>
<tr>
<td class="asm-label">vertex_visibility_1</td>
<td class="address-2"><span id="43511"></span>A9F7</td>
<td class="instruction">LD A,(IX+$04)</td>
<td class="comment-1" rowspan="1">Numbers of face 1 and 2</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43514"></span>A9FA</td>
<td class="instruction">CALL <a href="43536.html">check_face_visible</a></td>
<td class="comment-1" rowspan="1">Check if a face is visible</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43517"></span>A9FD</td>
<td class="instruction">JR NZ,<a href="43465.html#43525">vertex_visibility_2</a></td>
<td class="comment-1" rowspan="1">If yes move on to ...</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43519"></span>A9FF</td>
<td class="instruction">LD A,(IX+$05)</td>
<td class="comment-1" rowspan="1">Numbers of face 3 and 4</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43522"></span>AA02</td>
<td class="instruction">CALL <a href="43536.html">check_face_visible</a></td>
<td class="comment-1" rowspan="1">Check if a face is visible</td>
</tr>
<tr>
<td class="asm-label">vertex_visibility_2</td>
<td class="address-2"><span id="43525"></span>AA05</td>
<td class="instruction">JP NZ,<a href="44194.html">project_vertex</a></td>
<td class="comment-1" rowspan="1">If yes move on to project vertex</td>
</tr>
<tr>
<td class="asm-label">vertex_visibility_3</td>
<td class="address-2"><span id="43528"></span>AA08</td>
<td class="instruction">INC A</td>
<td class="comment-1" rowspan="1">Increment a to 1</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43529"></span>AA09</td>
<td class="instruction">LD (<a href="43464.html">first_vertex_flag</a>),A</td>
<td class="comment-1" rowspan="1">Set flag to 1</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43532"></span>AA0C</td>
<td class="instruction">POP AF</td>
<td class="comment-1" rowspan="1">Pop counter</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43533"></span>AA0D</td>
<td class="instruction">JP <a href="44194.html#44530">project_vertex_7</a></td>
<td class="comment-1" rowspan="1">Next vertex and loop</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="43464.html">A9C8</a>
</td>
<td class="up">Up: <a href="../maps/all.html#43465">Map</a></td>
<td class="next">
Next: <a href="43536.html">AA10</a>
</td>
</tr>
</table>
<footer>
<div class="release"></div>
<div class="copyright"></div>
<div class="created">Created using <a href="https://skoolkit.ca">SkoolKit</a> 9.5.</div>
</footer>
</body>
</html>