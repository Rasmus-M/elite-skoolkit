<!DOCTYPE html>
<html>
<head>
<title>Elite: Routine at 7FE3</title>
<meta charset="utf-8" />
<link rel="stylesheet" type="text/css" href="../skoolkit.css" />
</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a href="../index.html">Elite</a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="32702.html">7FBE</a>
</td>
<td class="up">Up: <a href="../maps/all.html#32739">Map</a></td>
<td class="next">
Next: <a href="32834.html">8042</a>
</td>
</tr>
</table>
<div class="description">7FE3: Routine at 7FE3</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="5">
<div class="details">
<div class="paragraph">
Copy every 2nd line of an area from buffer to screen.
</div>
</div>
<table class="input">
<tr class="asm-input-header">
<th colspan="2">Input</th>
</tr>
<tr>
<td class="register">HL</td>
<td class="register-desc">Source (screen buffer) address (110sslllrrrccccc)</td>
</tr>
<tr>
<td class="register">DE</td>
<td class="register-desc">Destination (screen) address (010sslllrrrccccc)</td>
</tr>
</table>
</td>
</tr>
<tr>
<td class="asm-label">copy_screen_area</td>
<td class="address-2"><span id="32739"></span>7FE3</td>
<td class="instruction">LD B,$08</td>
<td class="comment-1" rowspan="1">Number of rows?</td>
</tr>
<tr>
<td class="asm-label">copy_screen_area_0</td>
<td class="address-2"><span id="32741"></span>7FE5</td>
<td class="instruction">PUSH DE</td>
<td class="comment-1" rowspan="1">Save screen address</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="32742"></span>7FE6</td>
<td class="instruction">LD C,$FF</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="32744"></span>7FE8</td>
<td class="instruction">LD A,$04</td>
<td class="comment-1" rowspan="1">Number of lines?</td>
</tr>
<tr>
<td class="asm-label">copy_screen_area_1</td>
<td class="address-2"><span id="32746"></span>7FEA</td>
<td class="instruction">PUSH DE</td>
<td class="comment-1" rowspan="1">Save screen address</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="32747"></span>7FEB</td>
<td class="instruction">LDI</td>
<td class="comment-1" rowspan="1">Copy 32 bytes in unrolled loop</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="32749"></span>7FED</td>
<td class="instruction">LDI</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="32751"></span>7FEF</td>
<td class="instruction">LDI</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="32753"></span>7FF1</td>
<td class="instruction">LDI</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="32755"></span>7FF3</td>
<td class="instruction">LDI</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="32757"></span>7FF5</td>
<td class="instruction">LDI</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="32759"></span>7FF7</td>
<td class="instruction">LDI</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="32761"></span>7FF9</td>
<td class="instruction">LDI</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="32763"></span>7FFB</td>
<td class="instruction">LDI</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="32765"></span>7FFD</td>
<td class="instruction">LDI</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="32767"></span>7FFF</td>
<td class="instruction">LDI</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="32769"></span>8001</td>
<td class="instruction">LDI</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="32771"></span>8003</td>
<td class="instruction">LDI</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="32773"></span>8005</td>
<td class="instruction">LDI</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="32775"></span>8007</td>
<td class="instruction">LDI</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="32777"></span>8009</td>
<td class="instruction">LDI</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="32779"></span>800B</td>
<td class="instruction">LDI</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="32781"></span>800D</td>
<td class="instruction">LDI</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="32783"></span>800F</td>
<td class="instruction">LDI</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="32785"></span>8011</td>
<td class="instruction">LDI</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="32787"></span>8013</td>
<td class="instruction">LDI</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="32789"></span>8015</td>
<td class="instruction">LDI</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="32791"></span>8017</td>
<td class="instruction">LDI</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="32793"></span>8019</td>
<td class="instruction">LDI</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="32795"></span>801B</td>
<td class="instruction">LDI</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="32797"></span>801D</td>
<td class="instruction">LDI</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="32799"></span>801F</td>
<td class="instruction">LDI</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="32801"></span>8021</td>
<td class="instruction">LDI</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="32803"></span>8023</td>
<td class="instruction">LDI</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="32805"></span>8025</td>
<td class="instruction">LDI</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="32807"></span>8027</td>
<td class="instruction">LDI</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="32809"></span>8029</td>
<td class="instruction">LDI</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="32811"></span>802B</td>
<td class="instruction">POP DE</td>
<td class="comment-1" rowspan="1">Restore screen address at beginning of line</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="32812"></span>802C</td>
<td class="instruction">INC D</td>
<td class="comment-1" rowspan="1">One line down</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="32813"></span>802D</td>
<td class="instruction">INC D</td>
<td class="comment-1" rowspan="1">One line down</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="32814"></span>802E</td>
<td class="instruction">LD H,D</td>
<td class="comment-1" rowspan="1">Source MSB = dest MSB</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="32815"></span>802F</td>
<td class="instruction">SET 7,H</td>
<td class="comment-1" rowspan="1">Set msb to make source $cxxx</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="32817"></span>8031</td>
<td class="instruction">LD L,E</td>
<td class="comment-1" rowspan="1">Source follows destination</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="32818"></span>8032</td>
<td class="instruction">DEC A</td>
<td class="comment-1" rowspan="1">Line counter</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="32819"></span>8033</td>
<td class="instruction">JP NZ,<a href="32739.html#32746">copy_screen_area_1</a></td>
<td class="comment-1" rowspan="1">Loop for 4 lines</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="32822"></span>8036</td>
<td class="instruction">POP DE</td>
<td class="comment-1" rowspan="1">Restore screen address at top of section</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="32823"></span>8037</td>
<td class="instruction">LD A,E</td>
<td class="comment-1" rowspan="1">A=rrrccccc</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="32824"></span>8038</td>
<td class="instruction">ADD A,$20</td>
<td class="comment-1" rowspan="1">Next row</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="32826"></span>803A</td>
<td class="instruction">LD E,A</td>
<td class="comment-1" rowspan="1">Update destination</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="32827"></span>803B</td>
<td class="instruction">LD L,A</td>
<td class="comment-1" rowspan="1">Update source</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="32828"></span>803C</td>
<td class="instruction">LD H,D</td>
<td class="comment-1" rowspan="1">Source MSB = dest MSB</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="32829"></span>803D</td>
<td class="instruction">SET 7,H</td>
<td class="comment-1" rowspan="1">Set msb to make source $cxxx</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="32831"></span>803F</td>
<td class="instruction">DJNZ <a href="32739.html#32741">copy_screen_area_0</a></td>
<td class="comment-1" rowspan="1">Loop for 8 rows</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="32833"></span>8041</td>
<td class="instruction">RET</td>
<td class="comment-1" rowspan="1"></td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="32702.html">7FBE</a>
</td>
<td class="up">Up: <a href="../maps/all.html#32739">Map</a></td>
<td class="next">
Next: <a href="32834.html">8042</a>
</td>
</tr>
</table>
<footer>
<div class="release"></div>
<div class="copyright"></div>
<div class="created">Created using <a href="https://skoolkit.ca">SkoolKit</a> 9.5.</div>
</footer>
</body>
</html>