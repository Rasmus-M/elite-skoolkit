<!DOCTYPE html>
<html>
<head>
<title>Elite: Routine at AA2B</title>
<meta charset="utf-8" />
<link rel="stylesheet" type="text/css" href="../skoolkit.css" />
</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a href="../index.html">Elite</a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="43536.html">AA10</a>
</td>
<td class="up">Up: <a href="../maps/all.html#43563">Map</a></td>
<td class="next">
Next: <a href="43771.html">AAFB</a>
</td>
</tr>
</table>
<div class="description">AA2B: Routine at AA2B</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="5">
<div class="details">
<div class="paragraph">
Used by the routine at <a href="44194.html">project_vertex</a>.
</div>
</div>
<table class="input">
<tr class="asm-input-header">
<th colspan="2">Input</th>
</tr>
<tr>
<td class="register">IX</td>
<td class="register-desc">Vertex structure</td>
</tr>
<tr>
<td class="register">IY</td>
<td class="register-desc">Table of ship calculations</td>
</tr>
</table>
</td>
</tr>
<tr>
<td class="asm-label">LAA2B</td>
<td class="address-2"><span id="43563"></span>AA2B</td>
<td class="instruction">LD A,(<a href="43464.html">first_vertex_flag</a>)</td>
<td class="comment-1" rowspan="2">Is it the first vertex?</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43566"></span>AA2E</td>
<td class="instruction">AND A</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43567"></span>AA2F</td>
<td class="instruction">JR NZ,<a href="43563.html#43659">LAA2B_0</a></td>
<td class="comment-1" rowspan="1">Skip comparison with previous if it is</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43569"></span>AA31</td>
<td class="instruction">LD A,(IX+$00)</td>
<td class="comment-1" rowspan="1">Vertex x</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43572"></span>AA34</td>
<td class="instruction">CP (IX-$06)</td>
<td class="comment-1" rowspan="1">Compare with previous vertex x</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43575"></span>AA37</td>
<td class="instruction">JR NZ,<a href="43563.html#43659">LAA2B_0</a></td>
<td class="comment-1" rowspan="1">Move on if not the same</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43577"></span>AA39</td>
<td class="instruction">LD A,(IX+$01)</td>
<td class="comment-1" rowspan="1">Vertex y</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43580"></span>AA3C</td>
<td class="instruction">CP (IX-$05)</td>
<td class="comment-1" rowspan="1">Compare with previous vertex y</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43583"></span>AA3F</td>
<td class="instruction">JR NZ,<a href="43563.html#43659">LAA2B_0</a></td>
<td class="comment-1" rowspan="1">Move on if not the same</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43585"></span>AA41</td>
<td class="instruction">LD A,(IX+$02)</td>
<td class="comment-1" rowspan="1">Vertex z</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43588"></span>AA44</td>
<td class="instruction">CP (IX-$04)</td>
<td class="comment-1" rowspan="1">Compare with previous vertex z</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43591"></span>AA47</td>
<td class="instruction">JR NZ,<a href="43563.html#43659">LAA2B_0</a></td>
<td class="comment-1" rowspan="1">Move on if not the same</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43593"></span>AA49</td>
<td class="instruction">LD A,(IX+$03)</td>
<td class="comment-1" rowspan="1">Vertex signs</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43596"></span>AA4C</td>
<td class="instruction">XOR (IX-$03)</td>
<td class="comment-1" rowspan="1">XOR previous vertex signs</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43599"></span>AA4F</td>
<td class="instruction">LD B,A</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43600"></span>AA50</td>
<td class="instruction">LD L,(IY+$12)</td>
<td class="comment-1" rowspan="1">Magn face normal_x * sidev_x_hi</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43603"></span>AA53</td>
<td class="instruction">LD H,(IY+$13)</td>
<td class="comment-1" rowspan="1">Sign face normal_x * sidev_x_hi</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43606"></span>AA56</td>
<td class="instruction">LD E,(IY+$14)</td>
<td class="comment-1" rowspan="1">Magn face normal_y * roofv_x_hi</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43609"></span>AA59</td>
<td class="instruction">LD D,(IY+$15)</td>
<td class="comment-1" rowspan="1">Sign face normal_y * roofv_x_hi</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43612"></span>AA5C</td>
<td class="instruction">XOR H</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43613"></span>AA5D</td>
<td class="instruction">AND $80</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43615"></span>AA5F</td>
<td class="instruction">LD H,A</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43616"></span>AA60</td>
<td class="instruction">LD (IY+$13),H</td>
<td class="comment-1" rowspan="1">Sign face normal_x * sidev_x_hi</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43619"></span>AA63</td>
<td class="instruction">RL B</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43621"></span>AA65</td>
<td class="instruction">LD A,B</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43622"></span>AA66</td>
<td class="instruction">XOR D</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43623"></span>AA67</td>
<td class="instruction">AND $80</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43625"></span>AA69</td>
<td class="instruction">LD D,A</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43626"></span>AA6A</td>
<td class="instruction">LD (IY+$15),D</td>
<td class="comment-1" rowspan="1">Save in sign face normal_y * roofv_x_hi</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43629"></span>AA6D</td>
<td class="instruction">CALL <a href="43771.html">add_sign_mag_bytes</a></td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43632"></span>AA70</td>
<td class="instruction">LD L,A</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43633"></span>AA71</td>
<td class="instruction">LD E,(IY+$16)</td>
<td class="comment-1" rowspan="1">Magn face normal_z * nosev_x_hi</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43636"></span>AA74</td>
<td class="instruction">LD D,(IY+$17)</td>
<td class="comment-1" rowspan="1">Sign face normal_z * nosev_x_hi</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43639"></span>AA77</td>
<td class="instruction">LD A,B</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43640"></span>AA78</td>
<td class="instruction">RLA</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43641"></span>AA79</td>
<td class="instruction">XOR D</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43642"></span>AA7A</td>
<td class="instruction">AND $80</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43644"></span>AA7C</td>
<td class="instruction">LD D,A</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43645"></span>AA7D</td>
<td class="instruction">LD (IY+$17),D</td>
<td class="comment-1" rowspan="1">Save in sign face normal_z * nosev_x_hi</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43648"></span>AA80</td>
<td class="instruction">CALL <a href="43771.html">add_sign_mag_bytes</a></td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43651"></span>AA83</td>
<td class="instruction">LD L,A</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43652"></span>AA84</td>
<td class="instruction">LD DE,$0006</td>
<td class="comment-1" rowspan="2">Add 6 to IY, moving to next coordinate</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43655"></span>AA87</td>
<td class="instruction">ADD IY,DE</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43657"></span>AA89</td>
<td class="instruction">JR <a href="43563.html#43747">LAA2B_1</a></td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label">LAA2B_0</td>
<td class="address-2"><span id="43659"></span>AA8B</td>
<td class="instruction">LD B,(IX+$00)</td>
<td class="comment-1" rowspan="1">Vertex x</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43662"></span>AA8E</td>
<td class="instruction">CALL <a href="43806.html">mult_b_coord_scaled</a></td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43665"></span>AA91</td>
<td class="instruction">LD A,(IX+$03)</td>
<td class="comment-1" rowspan="1">Vertex signs</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43668"></span>AA94</td>
<td class="instruction">XOR (IY+$01)</td>
<td class="comment-1" rowspan="1">sidev_x_hi</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43671"></span>AA97</td>
<td class="instruction">RLA</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43672"></span>AA98</td>
<td class="instruction">RR H</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43674"></span>AA9A</td>
<td class="instruction">LD (IY+$12),L</td>
<td class="comment-1" rowspan="1">Save in magn face normal_x * sidev_x_hi</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43677"></span>AA9D</td>
<td class="instruction">LD (IY+$13),H</td>
<td class="comment-1" rowspan="1">Save in sign face normal_x * sidev_x_hi</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43680"></span>AAA0</td>
<td class="instruction">EX DE,HL</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43681"></span>AAA1</td>
<td class="instruction">INC IY</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43683"></span>AAA3</td>
<td class="instruction">INC IY</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43685"></span>AAA5</td>
<td class="instruction">LD B,(IX+$01)</td>
<td class="comment-1" rowspan="1">Vertex y</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43688"></span>AAA8</td>
<td class="instruction">CALL <a href="43806.html">mult_b_coord_scaled</a></td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43691"></span>AAAB</td>
<td class="instruction">LD A,(IX+$03)</td>
<td class="comment-1" rowspan="1">Vertex signs</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43694"></span>AAAE</td>
<td class="instruction">RLA</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43695"></span>AAAF</td>
<td class="instruction">XOR (IY+$01)</td>
<td class="comment-1" rowspan="1">sidev_x_hi</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43698"></span>AAB2</td>
<td class="instruction">RLA</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43699"></span>AAB3</td>
<td class="instruction">RR H</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43701"></span>AAB5</td>
<td class="instruction">LD (IY+$12),L</td>
<td class="comment-1" rowspan="1">Save in magn face normal_x * sidev_x_hi</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43704"></span>AAB8</td>
<td class="instruction">LD (IY+$13),H</td>
<td class="comment-1" rowspan="1">Save in sign face normal_x * sidev_x_hi</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43707"></span>AABB</td>
<td class="instruction">CALL <a href="43771.html">add_sign_mag_bytes</a></td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43710"></span>AABE</td>
<td class="instruction">LD L,A</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43711"></span>AABF</td>
<td class="instruction">EX DE,HL</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43712"></span>AAC0</td>
<td class="instruction">INC IY</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43714"></span>AAC2</td>
<td class="instruction">INC IY</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43716"></span>AAC4</td>
<td class="instruction">LD B,(IX+$02)</td>
<td class="comment-1" rowspan="1">Vertex y</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43719"></span>AAC7</td>
<td class="instruction">CALL <a href="43806.html">mult_b_coord_scaled</a></td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43722"></span>AACA</td>
<td class="instruction">LD A,(IX+$03)</td>
<td class="comment-1" rowspan="1">Vertex signs</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43725"></span>AACD</td>
<td class="instruction">RLA</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43726"></span>AACE</td>
<td class="instruction">RLA</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43727"></span>AACF</td>
<td class="instruction">XOR (IY+$01)</td>
<td class="comment-1" rowspan="1">sidev_x_hi</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43730"></span>AAD2</td>
<td class="instruction">RLA</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43731"></span>AAD3</td>
<td class="instruction">RR H</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43733"></span>AAD5</td>
<td class="instruction">LD (IY+$12),L</td>
<td class="comment-1" rowspan="1">Save in magn face normal_x * sidev_x_hi</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43736"></span>AAD8</td>
<td class="instruction">LD (IY+$13),H</td>
<td class="comment-1" rowspan="1">Save in sign face normal_x * sidev_x_hi</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43739"></span>AADB</td>
<td class="instruction">CALL <a href="43771.html">add_sign_mag_bytes</a></td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43742"></span>AADE</td>
<td class="instruction">LD L,A</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43743"></span>AADF</td>
<td class="instruction">INC IY</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43745"></span>AAE1</td>
<td class="instruction">INC IY</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label">LAA2B_1</td>
<td class="address-2"><span id="43747"></span>AAE3</td>
<td class="instruction">LD A,(<a href="43463.html">up_shift</a>)</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43750"></span>AAE6</td>
<td class="instruction">LD B,A</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43751"></span>AAE7</td>
<td class="instruction">XOR A</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43752"></span>AAE8</td>
<td class="instruction">LD C,H</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43753"></span>AAE9</td>
<td class="instruction">RES 7,H</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label">LAA2B_2</td>
<td class="address-2"><span id="43755"></span>AAEB</td>
<td class="instruction">SRL H</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43757"></span>AAED</td>
<td class="instruction">RR L</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43759"></span>AAEF</td>
<td class="instruction">RRA</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43760"></span>AAF0</td>
<td class="instruction">DJNZ <a href="43563.html#43755">LAA2B_2</a></td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43762"></span>AAF2</td>
<td class="instruction">JR NC,<a href="43563.html#43765">LAA2B_3</a></td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43764"></span>AAF4</td>
<td class="instruction">INC HL</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label">LAA2B_3</td>
<td class="address-2"><span id="43765"></span>AAF5</td>
<td class="instruction">BIT 7,C</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43767"></span>AAF7</td>
<td class="instruction">RET Z</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43768"></span>AAF8</td>
<td class="instruction">SET 7,H</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43770"></span>AAFA</td>
<td class="instruction">RET</td>
<td class="comment-1" rowspan="1"></td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="43536.html">AA10</a>
</td>
<td class="up">Up: <a href="../maps/all.html#43563">Map</a></td>
<td class="next">
Next: <a href="43771.html">AAFB</a>
</td>
</tr>
</table>
<footer>
<div class="release"></div>
<div class="copyright"></div>
<div class="created">Created using <a href="https://skoolkit.ca">SkoolKit</a> 9.5.</div>
</footer>
</body>
</html>